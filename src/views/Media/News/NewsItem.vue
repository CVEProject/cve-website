<template>
  <div id="cve-secondary-page-main-container">
    <div class="columns is-centered">
      <div class="column is-8-desktop cve-main-column-content-width is-12-tablet">
        <main id="cve-main-page-content" role="main">
          <div class="content" v-if="typeof newsItem === 'undefined'">
            <h1 class="title">News item not found.</h1>
          </div>
          <div class="content" v-else>
            <h1 class="title">{{newsItem.title}}</h1>
            <p class="cve-help-text">Many of the links on this page redirect to external websites
              <span class="icon cve-icon-xxs help-text-icon"><font-awesome-icon icon="external-link-alt" aria-labelledby="extenalSiteLinks"/></span>;
              these links will open a new window or tab depending on the web browser used.
            </p>
            <span class ="level is-mobile has-text-grey-dark mb-3">
              <div class ="level-left">
                <span class ="level-item tag is-rounded has-text-grey-dark is-capitalized">{{newsItem.newsType}}</span>
                <time class ="level-item" :datetime="newsItem.date">{{formatDate(newsItem.date)}}</time>
              </div>
            </span>
            <p class="ml-2" v-if="newsItem.newsType == 'blog'">By {{newsItem.author.name}},
              <span v-if="newsItem.author.organization.name !== 'CVE'">
                <a :href="newsItem.author.organization.url" v-if="newsItem.author.organization.name !== 'CVE'" target="_blank">
                  {{newsItem.author.organization.name}},
                </a>
                <span class="pl-1">{{newsItem.author.title}}</span>
              </span>
            </p>
            <div class="content ml-2 mt-5">
              <div class="block" v-for="(section, index) in newsItem.description" :key="index">
                <p v-if="section.contentnewsType == 'paragraph'" v-html="$sanitize(section.content)"></p>
                <blockquote v-if="section.contentnewsType == 'quote'">{{section.content}}</blockquote>
                <figure v-if="section.contentnewsType == 'video'" class="image is-3by2">
                  <iframe class="has-ratio" :src="section.content" frameborder="0" allowfullscreen>
                  </iframe>
                </figure>
                <figure v-if="section.contentnewsType == 'image'" class="image is-2by1" >
                  <img :src="`/images/${section.content}`" :alt="section.imgAltText">
                </figure>
              </div>
              <figure class="image is-3by2" v-if="newsItem.newsType == 'podcast'">
                <iframe class="has-ratio" :src="newsItem.url" frameborder="0" allowfullscreen>
                </iframe>
              </figure>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>
</template>

<script>
import newsData from '@/assets/data/news.json';
import createShortTitle from '../../../mixins/newsMixins';

export default {
  name: 'NewsItem',
  mixins: [createShortTitle],
  computed: {
    newsItem() {
      const urlParameters = this.$route.params;
      const itemDate = `${urlParameters.year}-${urlParameters.month}-${urlParameters.day}`;
      return newsData.find((newsItem) => {
        if (newsItem.newsType === urlParameters.newsType && newsItem.date === itemDate
          && this.createShortTitle(newsItem) === urlParameters.shortTitle) return true;
        return null;
      });
    },
  },
  methods: {
    formatDate(newsDate) {
      const yyyymmdd = newsDate.split('-');
      const formattedDate = new Date();
      formattedDate.setFullYear(parseInt(yyyymmdd[0], 10));
      formattedDate.setMonth(parseInt(yyyymmdd[1] - 1, 10));
      formattedDate.setDate(parseInt(yyyymmdd[2], 10));
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return formattedDate.toLocaleDateString(undefined, options);
    },
  },
};

</script>

<style scoped lang="scss">
@import '../../../assets/style/globals.scss';

</style>
