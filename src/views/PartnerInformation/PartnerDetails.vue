<template>
  <div id="cve-secondary-page-main-container">
    <div class="columns is-centered">
      <div class="column is-8-desktop cve-main-column-content-width is-12-tablet">
        <main id="cve-main-page-content" role="main">
          <div class="content">
            <h1 class="title">{{partner.organizationName}}</h1>
            <p class="cve-help-text">The majority of the links on this page redirect to external websites
              <span class="icon cve-icon-xxs help-text-icon"><font-awesome-icon icon="external-link-alt" aria-labelledby="externalSiteLinks"/></span>;
              these links will open a new window or tab depending on the web browser used.
            </p>
            <table class="table cve-border-dark-blue is-striped is-hoverable mb-1">
              <caption class="is-hidden">{{partner.organizationName}}</caption>
              <tbody>
                <tr>
                  <th style="width: 20%">Scope</th>
                  <td><span v-html="$sanitize(partner.scope)"></span></td>
                </tr>
                <tr>
                  <th style="width: 20%">Root</th>
                  <td>
                    <router-link :to="`/PartnerInformation/ListofPartners/partner/${$sanitize(partner.CNA.root.shortName)}`">
                      {{partner.CNA.isRoot ? 'N/A' : partner.CNA.root.organizationName}}
                    </router-link>
                  </td>
                </tr>
                <tr v-if="partner.securityAdvisories.hasOwnProperty('alerts') || partner.securityAdvisories.hasOwnProperty('advisories')">
                  <th style="width: 20%">Security Advisories</th>
                  <td>
                    <span v-if="partner.securityAdvisories.hasOwnProperty('alerts')">
                      <ul v-if="partner.securityAdvisories.alerts.length > 0" class="tile-body ml-0 pl-0 mb-0 cve-task-tile-list">
                        <li class="cve-list-no-bullet" v-for="(alert, index) in partner.securityAdvisories.alerts"
                          :key="partner.shortName + 'alert' + index">
                          <a :href="$sanitize(alert.url)">View {{alert.label}}</a>
                        </li>
                      </ul>
                    </span>
                    <span v-if="partner.securityAdvisories.hasOwnProperty('advisories')">
                      <ul v-if="Object.keys(partner.securityAdvisories.advisories).length > 0" class="tile-body ml-0 pl-0 cve-task-tile-list"
                        :class="{'mt-0': (partner.securityAdvisories.alerts.length) ? true : false}">
                        <li class="cve-list-no-bullet" v-for="(advisories, index) in partner.securityAdvisories.advisories"
                          :key="partner.shortName + 'advisories' + index">
                          <a :href="$sanitize(advisories.url)">View {{advisories.label}}</a>
                        </li>
                      </ul>
                    </span>
                  </td>
                </tr>
                <tr v-if="partner.CNA.role.length > 0">
                  <th style="width: 20%">Program Role</th>
                  <td>
                    <ul class="tile-body cve-task-tile-list ml-0 pl-0">
                      <li class="cve-list-no-bullet" v-for="role in partner.CNA.role" :key="role">{{role}}</li>
                    </ul>
                  </td>
                </tr>
                <tr v-if="partner.CNA.type.length > 0">
                  <th style="width: 20%">Organization Type</th>
                  <td>
                    <ul class="tile-body cve-task-tile-list ml-0 pl-0" v-if="partner.CNA.type.length > 0">
                      <li class="cve-list-no-bullet" v-for="type in partner.CNA.type" :key="type">{{type}}</li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <th style="width: 20%">Country*</th>
                  <td>{{partner.country}}</td>
                </tr>
              </tbody>
            </table>
            <p class="mb-2 cve-help-text">* Self-identified by CNA</p>
            <h2 class="title">Steps to report a vulnerability</h2>
            <div class="timeline">
              <header class="timeline-header">
                <span class="tag is-medium">Start</span>
              </header>
              <div class="timeline-item">
                <div class="timeline-marker">1</div>
                <div class="timeline-content">
                  <h3 class="title">Read disclosure policy</h3>
                    <ul class="tile-body cve-task-tile-list mb-0 ml-3 pl-0" v-if="partner.disclosurePolicy.length > 0">
                      <li class="cve-list-no-bullet" v-for="(disclosurePolicy, index) in partner.disclosurePolicy"
                        :key="partner.shortName + 'disclosurePolicy' + index">
                        <span><a :href="$sanitize(disclosurePolicy.url)">View {{disclosurePolicy.label}}</a>
                        </span>
                      </li>
                    </ul>
                    <p v-else class="tile-body">N/A</p>
                </div>
              </div>
              <div class="timeline-item">
                <div class="timeline-marker">2</div>
                <div class="timeline-content">
                  <h3 class="title">Contact</h3>
                  <div v-for="(contact, index) in partner.contact" :key="partner.shortName+'contact'+index">
                    <ul class="tile-body cve-task-tile-list mb-0 ml-3 pl-0" v-if="contact.email.length > 0">
                      <li class="cve-list-no-bullet" v-for="(email, index) in contact.email" :key="partner.shortName + 'email' + index">
                        <span v-if="email.label == email.emailAddr">
                          Email <a :href="'mailto:' + $sanitize(email.emailAddr)"> {{email.label}}</a>
                        </span>
                        <span v-else><a :href="'mailto:' + $sanitize(email.emailAddr)"> {{email.label}}</a></span>
                      </li>
                    </ul>
                    <ul class="tile-body cve-task-tile-list mb-0 ml-3 pl-0" v-if="contact.form.length > 0">
                      <li class="cve-list-no-bullet" v-for="(form, index) in contact.form" :key="partner.shortName + 'form' + index">
                        <a :href="$sanitize(form.url)"> {{form.label}}</a>
                      </li>
                    </ul>
                    <ul class="tile-body cve-task-tile-list mb-0 ml-3 pl-0" v-if="contact.contact.length > 0">
                      <li class="cve-list-no-bullet" v-for="(contactPage, index) in contact.contact"
                        :key="partner.shortName + 'contactPage' + index">
                        <a :href="$sanitize(contactPage.url)"> {{contactPage.label}}</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <footer class="timeline-header">
                <span class="tag is-medium">End</span>
              </footer>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>
</template>

<script>
import partnersList from '@/assets/data/CNAsList.json';

export default {
  computed: {
    partner() {
      const { shortName } = this.$route.params;
      return partnersList.find((partner) => partner.shortName === shortName);
    },
  },
};
</script>

<style scoped lang="scss">
@import '@/assets/style/globals.scss';
@import 'bulma';
@import 'bulma-timeline';

.tile.is-child.cve-task-tile {
  margin: 0.5rem !important;
}
</style>
