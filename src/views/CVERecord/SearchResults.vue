<template>
  <div id="cve-secondary-page-main-container">
    <div class="columns is-centered">
      <div class="column is-8-desktop cve-main-column-content-width">
        <main id="cve-main-page-content" role="main">
          <div class="content">
            <div
              class="cve-loading-message has-text-centered"
              v-if="useCveListSearchStore.cveRecordIsLoading || useCveListSearchStore.searchResultIsLoading"
            >
              <span class="icon-text">
                <span class="icon">
                  <span class="loader is-loading" />
                </span>
                <span>Please wait. Loading...</span>
              </span>
            </div>
            <div v-else>
              <div>
                <p>
                  <span class="has-text-weight-bold">{{ useCveListSearchStore.totalSearchResultCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',') }} results</span> for
                  <span class="has-text-weight-bold">{{ useCveListSearchStore.query }}</span>
                </p>
              </div>
              <div class="table-container" v-show="useCveListSearchStore.totalSearchResultCount >= 0">
                <table class="table is-striped is-hoverable cve-border-dark-blue is-fullwidth mb-1">
                  <thead>
                    <tr>
                      <th scope="col" class="is-hidden-desktop" >CVE ID</th>
                      <th scope="col" class="is-hidden-touch" style="width: 20%">CVE ID</th>
                      <th scope="col">Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="cve-search-result">
                      <td data-label="CVE ID" style="width: 20%">{{ useCveListSearchStore.recordData.cveId }}</td>
                      <td data-label="Description">
                        <p v-for="description in useCveListSearchStore.recordData.descriptions">{{ description }}</p>
                      </td>
                    </tr>
                    <tr
                      v-for="result in useCveListSearchStore.searchResults"
                    >
                      <td data-label="CVE ID" style="width: 20%">{{ result.cveId }}</td>
                      <td data-label="Description">
                        <p v-for="description in result.descriptions">{{ description }}</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>
</template>

<script>
  import { useCveListSearchStore } from '@/stores/cveListSearch';

  export default {
    name: 'SearchResults',
    data() {
      return {
        isMessageExpanded: false,
        useCveListSearchStore: useCveListSearchStore()
      };
    },
    // computed: {
    //   isSearching() {
    //     useCveListSearchStore().isSearching;
    //   },
    //   totalSearchResultCount() {
    //     useCveListSearchStore().totalSearchResultCount;
    //   },
    //   query() {
    //     useCveListSearchStore().query;
    //   },
    //   // recordData() {
    //   //   debugger
    //   //   useCveListSearchStore().recordData;
    //   // }
    // },
  };
</script>

<style lang="scss">
@import '@/assets/style/globals.scss';
@import '@/assets/style/elements/cveTableStacked.scss';

</style>