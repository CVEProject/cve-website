<template>
  <div id="cve-secondary-page-main-container">
    <div class="columns is-centered">
      <div class="column is-8-desktop cve-main-column-content-width">
        <main id="cve-main-page-content" role="main">
          <div class="content">
            <div v-if="useCveListSearchStore.showHelpText">
              <p class="has-text-centered">
                Please use the help text below the search box above to fix your keyword(s).
              </p></div>
            <div v-else>
              <div
                class="cve-loading-message has-text-centered"
                v-if="useCveListSearchStore.cveRecordIsLoading || useCveListSearchStore.searchResultIsLoading"
              >
                <span class="icon-text">
                  <span class="icon">
                    <span class="loader is-loading" />
                  </span>
                  <span>Please wait. Loading...</span>
                </span>
              </div>
              <div v-else>
                <div v-if="useCveListSearchStore.serverError" class="has-text-centered">
                  <h1 class="title is-4">Service is currently unavailable.</h1>
                  <p style="text-align: center;">Please
                    <span class="icon-text">
                      <a href="https://cveform.mitre.org/" target="_blank">report the issue
                        <span class="icon is-size-7 cve-icon-xxs">
                          <p id="extenalLink1" class="is-hidden">external site</p>
                          <font-awesome-icon icon="external-link-alt" aria-labelledby="extenalLink1" aria-hidden="false" focusable="false"/>
                        </span>
                      </a>
                    </span>
                    and try again later.<br/>Or, use
                    <a href="https://cve.mitre.org/cve/search_cve_list.html" target="_blank">Search CVE List on cve.mitre.org
                      <span class="icon is-size-7 cve-icon-xxs">
                        <p id="extenalLink1" class="is-hidden">external site</p>
                        <font-awesome-icon icon="external-link-alt" aria-labelledby="extenalLink1" aria-hidden="false" focusable="false"/>
                      </span>
                    </a>
                    to search CVE Records. Sorry for the inconvenience.
                  </p>
                </div>
                <div v-else>
                  <div v-if="useCveListSearchStore.totalSearchResultCount <= 0" class="has-text-centered">
                    <p>No search results.</p>
                  </div>
                  <div v-else>
                    <div>
                      <p>
                        <span class="has-text-weight-bold">{{ useCveListSearchStore.totalSearchResultCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',') }} results</span> for
                        <span class="has-text-weight-bold">{{ useCveListSearchStore.query }}</span>
                      </p>
                    </div>
                    <div class="table-container"
                      v-if="Object.keys(useCveListSearchStore.recordData).length > 0 || useCveListSearchStore.totalSearchResultCount > 0"
                    >
                      <table class="table is-striped is-hoverable cve-border-dark-blue is-fullwidth mb-1">
                        <thead>
                          <tr>
                            <th scope="col" class="is-hidden-desktop" >CVE ID</th>
                            <th scope="col" class="is-hidden-touch" style="width: 20%">CVE ID</th>
                            <th scope="col">Description</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr class="cve-search-result" v-if="Object.keys(useCveListSearchStore.recordData).length > 0">
                            <td data-label="CVE ID" style="width: 20%">{{ useCveListSearchStore.recordData.cveId }}</td>
                            <td data-label="Description">
                              <p v-for="description in useCveListSearchStore.recordData.descriptions">{{ description }}</p>
                            </td>
                          </tr>
                          <tr
                            v-for="result in useCveListSearchStore.searchResults"
                          >
                            <td data-label="CVE ID" style="width: 20%">{{ result.cveId }}</td>
                            <td data-label="Description">
                              <p v-for="description in result.descriptions">{{ description }}</p>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>
</template>

<script>
  import { useCveListSearchStore } from '@/stores/cveListSearch';

  export default {
    name: 'SearchResults',
    data() {
      return {
        isMessageExpanded: false,
        useCveListSearchStore: useCveListSearchStore()
      };
    },
  };
</script>

<style lang="scss">
@import '@/assets/style/globals.scss';
@import '@/assets/style/elements/cveTableStacked.scss';

</style>