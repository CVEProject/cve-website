<template>
  <div id="cpeCweCvss">
    <slot></slot>
    <div id="cve-cpes" v-if="cpes.length > 0">
      <p class="title is-6">CPE</p>
      <ul>
        <li v-for="cpe in cpes" :key="cpe.key">{{ cpe }}</li>
      </ul>
    </div>
    <div id="cve-cwes" v-if="cwes.length > 0">
      <p class="title is-6">CWE</p>
      <ul>
        <li v-for="cwe in cwes" :key="cwe.key">
          <span class="has-text-weight-bold">{{ cwe.cweId }}: </span><span>{{ cwe.description }}</span>
        </li>
      </ul>
    </div>
    <div id="cve-cvsss" v-if="cvsss.length > 0">
      <p class="title is-6">CVSS</p>
      <ul>
        <li v-for="cvss in cvsss" :key="cvss.key">
          <span class="has-text-weight-bold">version {{ cvss.version }} | </span>
          <span>{{ cvss.baseScore }} | </span>
          <span>{{ cvss.baseSeverity }} | </span>
          <span>{{ cvss.vectorString }}</span>
        </li>
      </ul>
    </div>
  </div>
</template>
  
  <script>
  export default {
    props: {
      containerObject: {
        type: Object,
        required: true,
      },
    },
    data() {
      return {
        cpes: [],
        cwes: [],
        cvsss: [],
      }
    },
    methods: {
      getCpes() {
        this.containerObject.affected.forEach( (affectedVersion) => {
          if (affectedVersion?.cpes) {
            affectedVersion.cpes.forEach( (cpe) => {
              this.cpes.push(cpe);
            });
          }
        });

        if (this.containerObject?.problemTypes) {
          this.containerObject.problemTypes.forEach( (problemType) => {
            if (problemType?.descriptions) {
              problemType.descriptions.forEach( (description) => {
                if (description.type.toLowerCase() === 'cwe') {
                  this.cwes.push(description);
                }
              });
            }
          });
        }

        if (this.containerObject?.metrics) {
          this.containerObject.metrics.forEach( (metric) => {
            let cvssVersion = Object.keys(metric).toString();
            if (['cvssV4_0', 'cvssV3_1', 'cvssV3_0', 'cvssV2_0'].includes(cvssVersion)) {
              this.cvsss.push(metric[cvssVersion]);
            }
          });
        }
      },
    },
    beforeMount() {
      this.getCpes();
    }
  };
  </script>
  
  <!-- Add "scoped" attribute to limit CSS to this component only -->
  <style scoped lang="scss">
  @import '../assets/style/globals.scss';
  
  </style>
  