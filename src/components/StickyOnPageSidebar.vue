<template>
  <aside class="menu cve-sidebar-menu mt-3" :class="isNavSidebarHiddenTouch ? 'is-hidden-touch' : ''">
    <p class="menu-label cve-capitalize-first-letter">On this page</p>
    <ul class="menu-list cve-capitalize-first-letter">
      <li v-for="(submenuObj, submenuLabel) in nav.submenu" :key="submenuObj.key">
        <span class="is-flex" style="justify-content: space-between; width: inherit">
          <router-link
            :to="`${submenuObj.path}?id=${useCveRecordLookupStore.cveId}#${submenuObj.anchorId}`"
            :class="isExactPath(`/${submenuObj.path}#${submenuObj.anchorId}`) ? '' : 'cve-not-active-link'"
          >
            {{ submenuLabel }} here
          </router-link>
        </span>
        <ul>
          <li v-for="(submenuItem, label) in submenuObj.items" :key="submenuObj.id + label">
            <router-link 
              :to="submenuObj.path + '#' + submenuItem.anchorId" 
              :class="isExactPath(`/${submenuObj.path}#${submenuItem.anchorId}`) ? '' : 'cve-not-active-link'"
            >
              {{ submenuItem.label }}
            </router-link>
          </li>
        </ul>
    </li>
    </ul>
  </aside>
</template>

<script>
import { useLinkStore } from '@/stores/link';
import { useCveRecordLookupStore } from '@/stores/cveRecordLookup.ts';


export default {
  name: 'StickyOnePageSidebar',
  props: {
    nav: {
      type: Object,
      required: true,
    },
    isNavSidebarHiddenTouch: {
      type: Boolean,
      required: false,
    },
  },
  data() {
    return {
      selectedSubmenu: [this.$route.path],
      useCveRecordLookupStore: useCveRecordLookupStore(),
    };
  },
  methods: {
    toggleSubmenuItem(path) {
      if (this.selectedSubmenu.includes(path)) {
        const index = this.selectedSubmenu.indexOf(path);
        this.selectedSubmenu.splice(index, 1);
      } else {
        this.selectedSubmenu.push(path);
      }
    },
    isExactPath(onPageLink) {
      return useLinkStore().isExactPath(onPageLink, this.$route.fullPath);
    }
  },
};
</script>

<style lang="scss">
  @import '../assets/style/globals.scss'; 
</style>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
@import '@/assets/style/routerLink.scss';

.cve-menu-shift {
  font-weight: bold;
  padding-left: 12px;
}

.menu-list {
  margin-left: unset !important;
}

li {
  list-style: none;
}

</style>
