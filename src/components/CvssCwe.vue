<template>
  <div id="cve-cvsss-cwes">
    <slot></slot>
    <div id="cve-cwes" v-if="cwes.length > 0">
      <p class="title is-5">CWE</p>
      <ul class="cve-y-scroll">
        <li v-for="cwe in cwes" :key="cwe.key">
          <span class="has-text-weight-bold">{{ cwe.cweId }}: </span><span>{{ cwe.description }}</span>
        </li>
      </ul>
    </div>
    <div id="cve-cvsss" v-if="cvsss.length > 0" class="mt-5">
      <p class="title is-5">CVSS</p>
      <div class="table-container cve-y-scroll" id="downloads-table">
        <table class="table is-striped is-hoverable cve-border-dark-blue cve-border-bottom-unset">
          <thead>
            <tr>
              <th>Version</th>
              <th>Score</th>
              <th>Severity</th>
              <th>Vector String</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="cvss in cvsss" :key="cvss.key">
              <td>{{ cvss.version }}</td>
              <td>{{ cvss.baseScore }}</td>
              <td>{{ cvss.baseSeverity }}</td>
              <td>{{ cvss.vectorString }}fsdfsdfsa/sdfsdf/ssdfasdfas/dafd</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>
  
  <script>
  export default {
    props: {
      containerObject: {
        type: Object,
        required: true,
      },
    },
    data() {
      return {
        cpes: [],
        cwes: [],
        cvsss: [],
      }
    },
    methods: {
      getCpes() {
        if (this.containerObject?.affected) {
          this.containerObject.affected.forEach( (affectedVersion) => {
          if (affectedVersion?.cpes) {
              affectedVersion.cpes.forEach( (cpe) => {
                this.cpes.push(cpe);
              });
            }
          });
        }

        if (this.containerObject?.problemTypes) {
          this.containerObject.problemTypes.forEach( (problemType) => {
            if (problemType?.descriptions) {
              problemType.descriptions.forEach( (description) => {
                if (description.type.toLowerCase() === 'cwe') {
                  this.cwes.push(description);
                }
              });
            }
          });
        }

        if (this.containerObject?.metrics) {
          this.containerObject.metrics.forEach( (metric) => {
            let cvssVersion = Object.keys(metric).toString();
            if (['cvssV4_0', 'cvssV3_1', 'cvssV3_0', 'cvssV2_0'].includes(cvssVersion)) {
              this.cvsss.push(metric[cvssVersion]);
            }
          });
        }
      },
    },
    beforeMount() {
      this.getCpes();
    }
  };
  </script>
  
  <!-- Add "scoped" attribute to limit CSS to this component only -->
  <style scoped lang="scss">
  @import '../assets/style/globals.scss';
  
.level {
  gap: 1rem;
}
.level-item {
  justify-content: left!important;
}

.cve-x-scroll {
  overflow-x: auto
}

.cve-y-scroll {
  max-height: 200px;
  overflow-y: auto;
}
  </style>
  